services:
  discord-bot:
    build: .
    container_name: discord-home-bot
    environment:
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - DISCORD_CHANNEL_ID=${DISCORD_CHANNEL_ID}
      - WEBHOOK_PORT=5000
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - DATABASE_PATH=/app/data/bot.db
      - LOG_LEVEL=info
      # Queue Configuration
      - QUEUE_RETRY_BASE_DELAY=${QUEUE_RETRY_BASE_DELAY:-60}
      - QUEUE_SCHEDULER_INTERVAL=${QUEUE_SCHEDULER_INTERVAL:-30}
      # Home Assistant Configuration (optional)
      - HA_URL=${HA_URL}
      - HA_ACCESS_TOKEN=${HA_ACCESS_TOKEN}
      - HA_VERIFY_SSL=${HA_VERIFY_SSL:-true}
      - HA_TIMEOUT=${HA_TIMEOUT:-10000}
      - HA_PERMISSIONS_CONFIG=${HA_PERMISSIONS_CONFIG:-/app/config/ha-permissions.json}
    ports:
      - "5000:5000"  # Serves both webhook API and sandbox UI
    volumes:
      - ./data:/app/data
      - ./config:/app/config
    restart: unless-stopped
    networks:
      - home-server
    # Access:
    #   - Webhook API: http://localhost:5000/webhook/*
    #   - Sandbox UI: http://localhost:5000/sandbox

networks:
  home-server:
    driver: bridge
